<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TownGL Demo</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="js/libs/three.js/Three.js"></script>
        <script src="js/TrackballControls.js"></script>        
        <script src="js/app.js"></script>        
    </head>
    <body>
        <script>
			var camera, scene, renderer;
            var clock = new THREE.Clock();
            var controls;
            
			init();
			animate();

			function init() {

				renderer = new THREE.WebGLRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.setClearColor( 0x87CEEB, 1 );
				document.body.appendChild( renderer.domElement );

				scene = new THREE.Scene();
 
				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
                camera.position.x = 5;
                camera.position.z = 20;
                
                var ambientLight = new THREE.AmbientLight( Math.random() * 0x202020 );
				scene.add( ambientLight );

				var directionalLight = new THREE.DirectionalLight( Math.random() * 0xffffff );
				directionalLight.position.x = Math.random() - 0.5;
				directionalLight.position.y = Math.random() - 0.5;
				directionalLight.position.z = Math.random() - 0.5;
				directionalLight.position.normalize();
				scene.add( directionalLight );

				pointLight = new THREE.PointLight( 0xff0000, 1 );
				scene.add( pointLight );
                
                createScene(scene);
                
                controls = new THREE.TrackballControls( camera );
				controls.rotateSpeed = 1.0;
				controls.zoomSpeed = 1.2;
				controls.panSpeed = 0.8;

				controls.noZoom = false;
				controls.noPan = false;

				controls.staticMoving = true;
				controls.dynamicDampingFactor = 0.3;

				controls.keys = [ 65, 83, 68 ];

				controls.addEventListener( 'change', render );                
                
				window.addEventListener( 'resize', onWindowResize, false );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );
                
                controls.handleResize();

			}

			function animate() {

				requestAnimationFrame( animate );

				//mesh.rotation.x += 0.005;
				//mesh.rotation.y += 0.01;
                //updateCamera(clock.getDelta());
                //controls.update( clock.getDelta() );
                controls.update();

				

			}            
            
			function render() {

				renderer.render( scene, camera );

			}
            
            var angle = 0;
            
            
            function updateCamera(currentFrame) {
              angle += 10 * currentFrame;
              if (angle > 360)
                angle -=360;

              var cosAngle = Math.cos (UTIL_TO_RADIANS (angle));
              var sinAngle = Math.sin (UTIL_TO_RADIANS (angle));
  
              var altitude = 0.5;
              var RADIUS = 9.5;
              var xEye = RADIUS * cosAngle;
                var yEye = altitude;
                var zEye = RADIUS * sinAngle;

                var xTarget = xEye + Math.cos (UTIL_TO_RADIANS (98 + angle));
                var yTarget = altitude;
                var zTarget = zEye + Math.sin (UTIL_TO_RADIANS (98 + angle));
                
                camera.lookAt (xTarget, yTarget, zTarget);
                camera.updateProjectionMatrix();
            }
        </script>

    </body>
</html>
